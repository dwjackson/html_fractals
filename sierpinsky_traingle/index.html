<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Sierpinsky Triangle</title>
    <style>
      #myCanvas {
	border: 1px solid black;
      }
    </style>
    <script>
      function Sierpinsky(iters) {
	this.rules = {'A': 'B-A-B', 'B': 'A+B+A', '+': '+', '-': '-'};
	this.axiom = 'A';
	this.angle = Math.pi / 3.0;

	var str = this.axiom;
	var c;
	var new_str;
	for (var i = 0; i < iters; i++) {
	  new_str = "";
	  for (var j = 0; j < str.length; j++) {
	    c = str[j];
	    new_str += this.rules[c];
	  }
	  str = new_str;
	}
	this.str = str;
      }

      function draw_sierpinsky(start_x, start_y, str, context) {
	var pos = {'x': start_x, 'y': start_y};
	context.moveTo(pos['x'], pos['y']);
	var u = 3;

	var vec = {'x': 1.0, 'y': 0.0};
	var R = [[0.5, 0 - Math.sqrt(3.0)/2.0], [Math.sqrt(3.0)/2.0, 0.5]];
	var Rm = [[0.5, Math.sqrt(3.0)/2.0], [0 - Math.sqrt(3.0)/2.0, 0.5]];

	var c;
	var tmp = {'x': 0.0, 'y': 0.0};
	for (var i = 0; i < str.length; i++) {
	  c = str[i];
	  if (c == 'A' || c == 'B') {
	    context.lineTo(pos['x'], pos['y']);
	    context.stroke();
	  } else if (c == '+') {
	    tmp['x'] = vec['x'];
	    tmp['y'] = vec['y'];
	    vec['x'] = R[0][0] * tmp['x'] + R[0][1] * vec['y'];
	    vec['y'] = R[1][0] * tmp['x'] + R[1][1] * vec['y'];
	    pos['x'] += vec['x'] * u;
	    pos['y'] += vec['y'] * u;
	  } else if (c == '-') {
	    tmp['x'] = vec['x'];
	    tmp['y'] = vec['y'];
	    vec['x'] = Rm[0][0] * tmp['x'] + Rm[0][1] * vec['y'];
	    vec['y'] = Rm[1][0] * tmp['x'] + Rm[1][1] * vec['y'];
	    pos['x'] += vec['x'] * u;
	    pos['y'] += vec['y'] * u;
	  }
	}
      }
    </script>
  </head>
  <body>
    <h1>Sierpinsky Triangle</h1>
    <div id="sierpinsky_str"></div>
    <canvas id="myCanvas" width="800" height="800"></canvas>
    <script>
      var iters = 8;
      var st = new Sierpinsky(iters);

      var canvas = document.getElementById("myCanvas");
      var context = canvas.getContext('2d');

      var x, y;
      x = 10;
      if (iters % 2 == 0) {
	y = 10;
      } else {
        y = 100 * iters;
      }

      draw_sierpinsky(x, y, st.str, context);
    </script>
  </body>
</html>
